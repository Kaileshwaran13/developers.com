<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Solo Leveling – Daily System</title>
<style>
:root {
  --bg:#070b12;
  --panel:#0e1624;
  --accent:#4fc3ff;
  --accent2:#7cff9a;
  --danger:#ff5f5f;
  --text:#e6f0ff;
  --muted:#9bb0cc;
}
* { box-sizing:border-box; margin:0; padding:0; }

html, body { width:100%; height:100%; font-family: 'Times New Roman', Times, serif;font-style: italic; background:#070b12; color:var(--text); }

.system-container {
  width:100%;
  height:100%;
  display:flex;
  justify-content:center;
  align-items:center;
  padding:20px 0;
}

.system {
  width:100%;
  max-width:1200px;
  height:95%; /* 95% of browser height */
  background:linear-gradient(180deg,#0e1624,#0a111d);
  border:1px solid #1c2a44;
  border-radius:16px;
  box-shadow:0 0 50px rgba(79,195,255,.3);
  padding:20px;
  display:flex;
  flex-direction:column;
  align-items:center;
  overflow:hidden;
}

h1 { font-size:2rem; color:var(--accent); text-align:center; margin-bottom:16px; animation:fadeInDown 1s ease; }
@keyframes fadeInDown { from {opacity:0; transform:translateY(-30px);} to {opacity:1; transform:translateY(0);} }

.status { display:grid; grid-template-columns: repeat(auto-fit, minmax(140px,1fr)); gap:10px; margin-bottom:20px; width:100%; }
.card { background:var(--panel); border:1px solid #1c2a44; border-radius:12px; padding:12px; text-align:center; }
.card .label { font-size:.8rem; color:var(--muted); }
.card .value { font-size:1.3rem; margin-top:4px; }

.section { width:100%; margin-bottom:15px; border:1px solid #1c2a44; border-radius:12px; overflow:hidden; display:flex; flex-direction:column; }
.section-header { background:var(--panel); padding:12px; cursor:pointer; display:flex; justify-content:space-between; align-items:center; user-select:none; font-weight:bold; font-size:1rem; }
.section-content { max-height:0; overflow:hidden; transition:max-height 0.4s ease, padding 0.4s ease; display:flex; flex-direction:column; gap:6px; padding:0 12px; }
.section-content.open { overflow-y:auto; padding:12px; }

.quests { display:flex; flex-direction:column; gap:6px; }
.quest { background:var(--panel); border:1px solid #1c2a44; border-radius:12px; padding:10px; display:flex; align-items:center; gap:12px; transition: all 0.3s ease; }
.quest.done { opacity:.6; text-decoration: line-through; }
.check { width:24px; height:24px; border-radius:6px; border:2px solid var(--accent); display:flex; align-items:center; justify-content:center; cursor:pointer; transition: all 0.25s; flex-shrink:0; }
.check.checked { background:var(--accent); box-shadow:0 0 14px rgba(79,195,255,.8); }
.check.checked::after { content:'✓'; color:#000; font-weight:700; animation:pop .25s ease-out; }
@keyframes pop { from { transform:scale(.3); opacity:0; } to { transform:scale(1); opacity:1; } }

.footer { margin-top:16px; text-align:center; font-size:.8rem; color:var(--muted); width:100%; }
.timeline { margin-top:16px; font-size:0.9rem; color:var(--muted); text-align:center; width:100%; display:flex; justify-content:space-between; }
.timeline div { flex:1; text-align:center; }

.todo-input { width:100%; display:flex; gap:8px; margin-bottom:10px; }
.todo-input input { flex:1; padding:8px; border-radius:6px; border:1px solid #1c2a44; background:var(--panel); color:var(--text); }
.todo-input button { padding:8px 14px; border-radius:6px; border:none; background:var(--accent); color:#000; cursor:pointer; font-weight:bold; }

/* Password overlay */
#passwordOverlay { position:fixed; top:0; left:0; width:100%; height:100%; background:black; display:flex; justify-content:center; align-items:center; z-index:1000; flex-direction:column; }
#passwordOverlay input { padding:12px; font-size:1.2rem; border-radius:8px; border:none; background:#111; color:#fff; text-align:center; width:220px; }
#passwordOverlay span { color:red; margin-top:12px; font-size:1rem; opacity:0; transition:opacity 0.3s; }

</style>
</head>
<body>

<div id="passwordOverlay">
  <input type="password" id="passwordInput" placeholder="Enter Password" autofocus>
  <span id="pwError">Unauthorized Access</span>
</div>

<div class="system-container" style="display:none;">
  <div class="system">
    <h1>SYSTEM – DAILY QUEST</h1>
    <h1>E-RANK</h1>

    <div class="status">
      <div class="card"><div class="label">LEVEL</div><div id="level" class="value">1</div></div>
      <div class="card"><div class="label">RANK</div><div id="rank" class="value">E</div></div>
      <div class="card"><div class="label">EXP</div><div id="exp" class="value">0 / 100</div></div>
      <div class="card"><div class="label">STRENGTH</div><div id="str" class="value">0</div></div>
      <div class="card"><div class="label">ENDURANCE</div><div id="end" class="value">0</div></div>
    </div>

    <div class="section">
      <div class="section-header" onclick="toggleSection('workoutsContent')">Workout <span>&#9660;</span></div>
      <div class="section-content" id="workoutsContent"></div>
    </div>

    <div class="section">
      <div class="section-header" onclick="toggleSection('todoContent')">To Do <span>&#9660;</span></div>
      <div class="section-content" id="todoContent">
        <div class="todo-input">
          <input type="text" id="newTask" placeholder="Add new task and press Enter">
          <button id="addBtn">Add</button>
        </div>
        <div id="todoList" class="quests"></div>
      </div>
    </div>

    <div class="footer">Resets automatically at 00:00</div>
    <div class="timeline">
      <div id="currentStreak">Current Streak Days: 0</div>
      <div id="missedStreak">Missed Days: 0</div>
    </div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getDatabase, ref, get, set } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

const firebaseConfig = {
  projectId: "solo-leveling-36aca",
  databaseURL: "https://solo-leveling-36aca-default-rtdb.firebaseio.com"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const userId = 'defaultUser';

// PASSWORD CHECK
const overlay = document.getElementById('passwordOverlay');
const input = document.getElementById('passwordInput');
const errorMsg = document.getElementById('pwError');

input.addEventListener('keydown', e=>{
  if(e.key==='Enter'){
    if(input.value==='K@ilesh13'){
      overlay.style.display='none';
      document.querySelector('.system-container').style.display='flex';
      initSystem();
    } else {
      errorMsg.style.opacity=1;
    }
  }
});

function initSystem(){
let level=1, exp=0, expNeeded=100, str=0, end=0, completed=[], streakDays=0, missedDays=0, todoTasks=[];

const baseQuests=[['Push-ups',25,'reps'], ['Sit-ups',100,'reps'], ['Squats',100,'reps'], ['Dips',100,'reps'],
['Inverted Rows',100,'reps'], ['Russian Twist',100,'reps'], ['Lunges',100,'reps'], ['Arm Presser (Each Side)',100,'reps'],
['Plank',3,'mins'], ['Left Side Plank',3,'mins'], ['Right Side Plank',3,'mins'], ['Swimming',60,'mins'], ['Cycling / Walking',10,'kms']];

function getMultiplier(){ return 1+(level-1)*0.05; }
function getRank(totalExp){ if(totalExp<10000)return'E'; if(totalExp<20000)return'D'; if(totalExp<30000)return'C';
if(totalExp<40000)return'B'; if(totalExp<50000)return'A'; if(totalExp<60000)return'S';
if(totalExp<70000)return'SS'; if(totalExp<80000)return'SSS'; if(totalExp<90000)return'SSS+'; return'∞'; }

async function loadData(){
  try{
    const snapshot=await get(ref(db,'users/'+userId));
    const data=snapshot.val();
    if(data){
      level=data.level||1; exp=data.exp||0; expNeeded=data.expNeeded||100;
      str=data.str||0; end=data.end||0; completed=data.completed||[];
      streakDays=data.streakDays||0; missedDays=data.missedDays||0;
      todoTasks=data.todoTasks||[];
    }
    buildQuests(); buildTodo(); updateUI(); updateTimeline();
  } catch(e){ console.error('Firebase Load Error:', e); }
}

function saveData(){
  set(ref(db,'users/'+userId),{level, exp, expNeeded, str, end, completed, streakDays, missedDays, todoTasks});
}

function buildQuests(){
  const wrap=document.getElementById('workoutsContent'); wrap.innerHTML='';
  const m=getMultiplier();
  baseQuests.forEach(([name,val,type])=>{
    let displayVal = name==='Swimming' ? val : Math.round(val*m); // Swimming stays constant
    const q=document.createElement('div');
    q.className='quest'+(completed.includes(name)?' done':'');
    q.dataset.name=name;
    q.innerHTML=`<div class='check ${completed.includes(name)?'checked':''}' onclick='toggleQuest(this)'></div><span>${name} – ${displayVal} ${type}</span>`;
    wrap.appendChild(q);
  });
}

window.toggleQuest=function(box){
  const quest=box.parentElement; const name=quest.dataset.name;
  if(completed.includes(name)) return; completed.push(name);
  if(name!=='Swimming'){ str+=1; end+=1; exp+=10; } // Swimming doesn't increase stats
  if(exp>=expNeeded){ level+=1; exp=0; expNeeded=Math.floor(expNeeded*1.3); }
  saveData(); buildQuests(); updateUI(); updateTimeline();
}

window.toggleSection=function(id){
  const el=document.getElementById(id);
  if(el.classList.contains('open')){ el.style.maxHeight='0px'; el.classList.remove('open'); }
  else{ el.classList.add('open'); el.style.maxHeight=el.scrollHeight+'px'; }
}

function updateUI(){
  document.getElementById('level').textContent=level;
  document.getElementById('rank').textContent=getRank(level*10);
  document.getElementById('exp').textContent=`${exp} / ${expNeeded}`;
  document.getElementById('str').textContent=str;
  document.getElementById('end').textContent=end;
}

function updateTimeline(){
  document.getElementById('currentStreak').textContent=`Current Streak Days: ${streakDays}`;
  document.getElementById('missedStreak').textContent=`Missed Days: ${missedDays}`;
}

// Todo Section (fixed)
function buildTodo(){
  const todoList=document.getElementById('todoList'); 
  todoList.innerHTML='';
  todoTasks.forEach(task=>{
    const div=document.createElement('div'); 
    div.className='quest';

    const checkBox=document.createElement('div');
    checkBox.className='check';
    if(task.done) checkBox.classList.add('checked');

    const span=document.createElement('span');
    span.textContent = task.text;

    checkBox.addEventListener('click', ()=>{
      task.done = !task.done;
      checkBox.classList.toggle('checked');
      saveData();
    });

    div.appendChild(checkBox);
    div.appendChild(span);
    todoList.appendChild(div);
  });
}

function addTodo(){
  const val=document.getElementById('newTask').value.trim();
  if(!val) return;
  todoTasks.push({text:val, done:false});
  document.getElementById('newTask').value='';
  buildTodo(); saveData();
}

document.getElementById('newTask').addEventListener('keydown',e=>{ if(e.key==='Enter') addTodo(); });
document.getElementById('addBtn').addEventListener('click',addTodo);

loadData();
} // end initSystem
</script>
</body>
</html>
