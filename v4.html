<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Solo Leveling – Daily System</title>
<style>
  :root {
    --bg:#070b12;
    --panel:#0e1624;
    --accent:#4fc3ff;
    --accent2:#7cff9a;
    --danger:#ff5f5f;
    --text:#e6f0ff;
    --muted:#9bb0cc;
  }
  * { box-sizing:border-box; }
  body {
    margin:0;
    font-family:"Segoe UI",system-ui,sans-serif;
    background:radial-gradient(circle at top,#0c1422,var(--bg));
    color:var(--text);
    min-height:100vh;
    display:flex;
    justify-content:center;
    align-items:center;
    padding:16px;
  }
  .system {
    width:100%;
    max-width:900px;
    background:linear-gradient(180deg,#0e1624,#0a111d);
    border:1px solid #1c2a44;
    border-radius:16px;
    box-shadow:0 0 40px rgba(79,195,255,.15);
    padding:16px;
    display:flex;
    flex-direction:column;
    align-items:center;
  }
  h1 { margin:0 0 12px; font-size:1.4rem; letter-spacing:1px; color:var(--accent); text-align:center; }
  .status { display:grid; grid-template-columns: repeat(auto-fit, minmax(140px,1fr)); gap:10px; margin-bottom:14px; width:100%; }
  .card { background:var(--panel); border:1px solid #1c2a44; border-radius:12px; padding:10px; text-align:center; }
  .card .label { font-size:.7rem; color:var(--muted); }
  .card .value { font-size:1.1rem; margin-top:2px; }
  .section { width:100%; margin-bottom:12px; border:1px solid #1c2a44; border-radius:12px; }
  .section-header { cursor:pointer; display:flex; justify-content:space-between; align-items:center; padding:10px; background:var(--panel); border-bottom:1px solid #1c2a44; }
  .section-header:hover { background:rgba(79,195,255,.05); }
  .arrow { transition: transform 0.3s ease; }
  .arrow.collapsed { transform: rotate(-90deg); }
  .section-content { overflow:hidden; transition: max-height 0.4s ease, padding 0.4s ease; padding:10px; }
  .quest { background:var(--panel); border:1px solid #1c2a44; border-radius:12px; padding:10px; display:flex; align-items:center; gap:10px; margin-bottom:6px; }
  .quest.done { opacity:.6; text-decoration: line-through; }
  .check { width:22px; height:22px; border-radius:6px; border:2px solid var(--accent); display:flex; align-items:center; justify-content:center; cursor:pointer; transition:.25s; flex-shrink:0; }
  .check.checked { background:var(--accent); box-shadow:0 0 12px rgba(79,195,255,.9); }
  .check.checked::after { content:'✓'; color:#000; font-weight:700; animation:pop .25s ease-out; }
  @keyframes pop { from { transform:scale(.3); opacity:0; } to { transform:scale(1); opacity:1; } }
  .footer { margin-top:12px; text-align:center; font-size:.7rem; color:var(--muted); width:100%; }
  .timeline { margin-top:16px; font-size:.8rem; color:var(--muted); text-align:center; width:100%; display:flex; justify-content:space-between; }
  .timeline div { flex:1; text-align:center; }
  .todo-input { display:flex; gap:8px; margin-bottom:8px; }
  .todo-input input { flex:1; padding:6px; border-radius:6px; border:1px solid #1c2a44; background:var(--panel); color:var(--text); }
  .todo-input button { padding:6px 10px; border:none; border-radius:6px; background:var(--accent); color:#000; cursor:pointer; transition:.2s; }
  .todo-input button:hover { background:var(--accent2); }
</style>
</head>
<body>
<div class="system">
  <h1>SYSTEM – DAILY QUEST (E-RANK)</h1>
  <div class="status">
    <div class="card"><div class="label">LEVEL</div><div id="level" class="value">1</div></div>
    <div class="card"><div class="label">RANK</div><div id="rank" class="value">E</div></div>
    <div class="card"><div class="label">EXP</div><div id="exp" class="value">0 / 100</div></div>
    <div class="card"><div class="label">STRENGTH</div><div id="str" class="value">0</div></div>
    <div class="card"><div class="label">ENDURANCE</div><div id="end" class="value">0</div></div>
  </div>

  <!-- Workout Section -->
  <div class="section">
    <div class="section-header" onclick="toggleSection(this)">
      <span>Workout Quests</span><span class="arrow">▶</span>
    </div>
    <div class="section-content" id="workoutContent"></div>
  </div>

  <!-- To Do Section -->
  <div class="section">
    <div class="section-header" onclick="toggleSection(this)">
      <span>To Do</span><span class="arrow">▶</span>
    </div>
    <div class="section-content" id="todoContent">
      <div class="todo-input">
        <input type="text" id="newTodo" placeholder="Add new task">
        <button id="addTodoBtn">Add</button>
      </div>
      <div id="todoList"></div>
    </div>
  </div>

  <div class="footer">Resets automatically at 00:00</div>
  <div class="timeline">
    <div id="currentStreak">Current Streak Days: 0</div>
    <div id="missedStreak">Missed Days: 0</div>
  </div>
</div>

<!-- Firebase SDKs -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getDatabase, ref, get, set } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

  const firebaseConfig = {
    projectId: "solo-leveling-36aca",
    databaseURL: "https://solo-leveling-36aca-default-rtdb.firebaseio.com"
  };
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const userId = 'defaultUser';

  let level=1, exp=0, expNeeded=100, str=0, end=0, completed=[];
  let streakDays=0, missedDays=0;
  let todos = [];

  const workoutQuests=[
    ['Push-ups',25,'reps'], ['Sit-ups',100,'reps'], ['Squats',100,'reps'], ['Dips',100,'reps'], ['Inverted Rows',100,'reps'],
    ['Russian Twist',100,'reps'], ['Lunges',100,'reps'], ['Arm Presser (Each Side)',100,'reps'], ['Plank',3,'mins'],
    ['Left Side Plank',3,'mins'], ['Right Side Plank',3,'mins'], ['Swimming',60,'mins'], ['Cycling / Walking',10,'kms']
  ];

  function getMultiplier(){ return 1+(level-1)*0.05; }
  function getRank(totalExp){
    if(totalExp<10000) return 'E'; if(totalExp<20000) return 'D'; if(totalExp<30000) return 'C';
    if(totalExp<40000) return 'B'; if(totalExp<50000) return 'A'; if(totalExp<60000) return 'S';
    if(totalExp<70000) return 'SS'; if(totalExp<80000) return 'SSS'; if(totalExp<90000) return 'SSS+';
    return '∞';
  }

  async function loadData(){
    try {
      const snapshot = await get(ref(db, 'users/' + userId));
      const data = snapshot.val();
      if(data){
        level = data.level || 1;
        exp = data.exp || 0;
        expNeeded = data.expNeeded || 100;
        str = data.str || 0;
        end = data.end || 0;
        completed = data.completed || [];
        streakDays = data.streakDays || 0;
        missedDays = data.missedDays || 0;
        todos = data.todos || [];
      }
      buildWorkout();
      buildTodo();
      updateUI();
      updateTimeline();
    } catch(e){ console.error('Firebase Load Error:', e); }
  }

  function saveData(){
    set(ref(db, 'users/' + userId), {level, exp, expNeeded, str, end, completed, streakDays, missedDays, todos});
  }

  function buildWorkout(){
    const wrap = document.getElementById('workoutContent'); wrap.innerHTML='';
    const m = getMultiplier();
    workoutQuests.forEach(([name,val,type])=>{
      let displayVal = val;
      if(!['Swimming','Cycling / Walking'].includes(name)) displayVal = Math.round(val*m);
      const q = document.createElement('div');
      q.className = 'quest' + (completed.includes(name)?' done':'');
      q.dataset.name = name;
      q.innerHTML = `<div class="check ${completed.includes(name)?'checked':''}" onclick="toggleWorkout(this)"></div><span>${name} – ${displayVal}${type? ' '+type:''}</span>`;
      wrap.appendChild(q);
    });
  }

  function toggleWorkout(box){
    const quest = box.parentElement;
    const name = quest.dataset.name;
    if(completed.includes(name)) return;
    completed.push(name);
    if(!['Swimming','Cycling / Walking'].includes(name)){ str+=1; end+=1; }
    exp+=10;
    if(exp>=expNeeded){ level+=1; exp=0; expNeeded=Math.floor(expNeeded*1.3); }
    if(completed.length === workoutQuests.length){ streakDays +=1; missedDays=0; }
    saveData(); buildWorkout(); updateUI(); updateTimeline();
  }

  function buildTodo(){
    const wrap = document.getElementById('todoList'); wrap.innerHTML='';
    todos.forEach((task, i)=>{
      const div = document.createElement('div');
      div.className='quest'+(task.completed?' done':'');
      div.dataset.index = i;
      div.innerHTML=`<div class="check ${task.completed?'checked':''}" onclick="toggleTodo(this)"></div><span>${task.text}</span>`;
      wrap.appendChild(div);
    });
  }

  function toggleTodo(box){
    const idx = box.parentElement.dataset.index;
    todos[idx].completed = !todos[idx].completed;
    saveData(); buildTodo();
  }

  document.getElementById('addTodoBtn').addEventListener('click',()=>{
    const val = document.getElementById('newTodo').value.trim();
    if(val){ todos.push({text:val, completed:false}); document.getElementById('newTodo').value=''; saveData(); buildTodo(); }
  });
  document.getElementById('newTodo').addEventListener('keydown', e=>{ if(e.key==='Enter') document.getElementById('addTodoBtn').click(); });

  function toggleSection(header){
    const content = header.nextElementSibling;
    const arrow = header.querySelector('.arrow');
    if(content.style.maxHeight && content.style.maxHeight !== '0px'){
      content.style.maxHeight='0'; content.style.padding='0 10px'; arrow.classList.add('collapsed');
    } else {
      content.style.maxHeight = content.scrollHeight+'px'; content.style.padding='10px'; arrow.classList.remove('collapsed');
    }
  }

  function updateUI(){
    document.getElementById('level').textContent = level;
    document.getElementById('rank').textContent = getRank(level*10);
    document.getElementById('exp').textContent = `${exp} / ${expNeeded}`;
    document.getElementById('str').textContent = str;
    document.getElementById('end').textContent = end;
  }

  function updateTimeline(){
    document.getElementById('currentStreak').textContent = `Current Streak Days: ${streakDays}`;
    document.getElementById('missedStreak').textContent = `Missed Days: ${missedDays}`;
  }

  loadData();
</script>
</body>
</html>
