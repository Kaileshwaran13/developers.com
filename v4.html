<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Solo Leveling – Daily System</title>
<style>
:root {
  --bg:#070b12;
  --panel:#0e1624;
  --accent:#4fc3ff;
  --accent2:#7cff9a;
  --danger:#ff5f5f;
  --text:#e6f0ff;
  --muted:#9bb0cc;
}
* { box-sizing:border-box; }
body {
  margin:0;
  font-family:"Segoe UI",system-ui,sans-serif;
  background:radial-gradient(circle at top,#0c1422,var(--bg));
  color:var(--text);
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  padding:16px;
}
.system {
  width:100%;
  max-width:1100px;
  background:linear-gradient(180deg,#0e1624,#0a111d);
  border:1px solid #1c2a44;
  border-radius:16px;
  box-shadow:0 0 40px rgba(79,195,255,.15);
  padding:16px;
  display:flex;
  flex-direction:column;
  align-items:center;
}
h1 {
  margin:0 0 12px;
  font-size:1.4rem;
  letter-spacing:1px;
  color:var(--accent);
  text-align:center;
}
.section {
  width:100%;
  margin-bottom:10px;
  border:1px solid #1c2a44;
  border-radius:12px;
  overflow:hidden;
}
.section-header {
  background:var(--panel);
  padding:10px;
  cursor:pointer;
  display:flex;
  justify-content:space-between;
  align-items:center;
  user-select:none;
}
.section-content {
  max-height:0;
  overflow:hidden;
  transition:max-height 0.3s ease;
  display:flex;
  flex-direction:column;
  gap:5px;
  padding:0 10px;
}
.section-content.open { max-height:1000px; padding:10px; }
.status { display:grid; grid-template-columns: repeat(auto-fit, minmax(140px,1fr)); gap:10px; margin-bottom:14px; width:100%; }
.card { background:var(--panel); border:1px solid #1c2a44; border-radius:12px; padding:10px; text-align:center; }
.card .label { font-size:.7rem; color:var(--muted); }
.card .value { font-size:1.1rem; margin-top:2px; }
.quests { display:flex; flex-direction:column; gap:5px; }
.quest { background:var(--panel); border:1px solid #1c2a44; border-radius:12px; padding:10px; display:flex; align-items:center; gap:10px; }
.quest.done { opacity:.6; text-decoration: line-through; }
.check { width:22px; height:22px; border-radius:6px; border:2px solid var(--accent); display:flex; align-items:center; justify-content:center; cursor:pointer; transition:.25s; flex-shrink:0; }
.check.checked { background:var(--accent); box-shadow:0 0 12px rgba(79,195,255,.9); }
.check.checked::after { content:'✓'; color:#000; font-weight:700; animation:pop .25s ease-out; }
@keyframes pop { from { transform:scale(.3); opacity:0; } to { transform:scale(1); opacity:1; } }
.footer { margin-top:12px; text-align:center; font-size:.7rem; color:var(--muted); width:100%; }
.timeline { margin-top:16px; font-size:.8rem; color:var(--muted); text-align:center; width:100%; display:flex; justify-content:space-between; }
.timeline div { flex:1; text-align:center; }
.todo-input { width:100%; display:flex; gap:5px; margin-bottom:5px; }
.todo-input input { flex:1; padding:5px; border-radius:6px; border:1px solid #1c2a44; background:var(--panel); color:var(--text); }
.todo-input button { padding:5px 10px; border-radius:6px; border:none; background:var(--accent); color:#000; cursor:pointer; }
</style>
</head>
<body>
<div class="system">
  <h1>SYSTEM – DAILY QUEST (E-RANK)</h1>
  <div class="status">
    <div class="card"><div class="label">LEVEL</div><div id="level" class="value">1</div></div>
    <div class="card"><div class="label">RANK</div><div id="rank" class="value">E</div></div>
    <div class="card"><div class="label">EXP</div><div id="exp" class="value">0 / 100</div></div>
    <div class="card"><div class="label">STRENGTH</div><div id="str" class="value">0</div></div>
    <div class="card"><div class="label">ENDURANCE</div><div id="end" class="value">0</div></div>
  </div>

  <div class="section">
    <div class="section-header" onclick="toggleSection('workoutsContent')">Workout <span>&#9660;</span></div>
    <div class="section-content" id="workoutsContent"></div>
  </div>

  <div class="section">
    <div class="section-header" onclick="toggleSection('todoContent')">To Do <span>&#9660;</span></div>
    <div class="section-content" id="todoContent">
      <div class="todo-input">
        <input type="text" id="newTask" placeholder="Add new task and press Enter">
        <button id="addTaskBtn">Add</button>
      </div>
      <div id="todoList" class="quests"></div>
    </div>
  </div>

  <div class="footer">Resets automatically at 00:00</div>
  <div class="timeline">
    <div id="currentStreak">Current Streak Days: 0</div>
    <div id="missedStreak">Missed Days: 0</div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getDatabase, ref, get, set } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

// --- PASSWORD PROTECTION ---
const password = prompt("Enter password to access:");
if(password !== "K@ilesh13"){
    alert("Unauthorized access! You cannot view this page.");
    document.body.innerHTML = "<h2 style='color:red; text-align:center; margin-top:50px;'>Unauthorized Access</h2>";
    throw new Error("Unauthorized access");
}

// --- FIREBASE ---
const firebaseConfig = {
  projectId: "solo-leveling-36aca",
  databaseURL: "https://solo-leveling-36aca-default-rtdb.firebaseio.com"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const userId = 'defaultUser';

// --- SYSTEM DATA ---
let level=1, exp=0, expNeeded=100, str=0, end=0, completed=[], streakDays=0, missedDays=0;
const baseQuests=[
  ['Push-ups',25,'reps'], ['Sit-ups',100,'reps'], ['Squats',100,'reps'], ['Dips',100,'reps'], ['Inverted Rows',100,'reps'],
  ['Russian Twist',100,'reps'], ['Lunges',100,'reps'], ['Arm Presser (Each Side)',100,'reps'], ['Plank',3,'mins'],
  ['Left Side Plank',3,'mins'], ['Right Side Plank',3,'mins'], ['Swimming',60,'mins'], ['Cycling / Walking',10,'kms']
];

// --- UI HELPERS ---
function getMultiplier(){ return 1+(level-1)*0.05; }
function getRank(totalExp){
  if(totalExp<10000) return 'E'; if(totalExp<20000) return 'D'; if(totalExp<30000) return 'C';
  if(totalExp<40000) return 'B'; if(totalExp<50000) return 'A'; if(totalExp<60000) return 'S';
  if(totalExp<70000) return 'SS'; if(totalExp<80000) return 'SSS'; if(totalExp<90000) return 'SSS+';
  return '∞';
}

window.toggleSection = function(id){
  const el = document.getElementById(id);
  if(el.classList.contains('open')){
    el.classList.remove('open');
  } else {
    el.classList.add('open');
  }
}

// --- LOAD FIREBASE DATA ---
async function loadData(){
  try {
    const snapshot = await get(ref(db, 'users/' + userId));
    const data = snapshot.val();
    if(data){
      level = data.level || 1;
      exp = data.exp || 0;
      expNeeded = data.expNeeded || 100;
      str = data.str || 0;
      end = data.end || 0;
      completed = data.completed || [];
      streakDays = data.streakDays || 0;
      missedDays = data.missedDays || 0;
    }
    buildQuests();
    updateUI();
    updateTimeline();
  } catch(e){ console.error('Firebase Load Error:', e); }
}

function saveData(){
  set(ref(db, 'users/' + userId), {level, exp, expNeeded, str, end, completed, streakDays, missedDays});
}

// --- WORKOUTS ---
function buildQuests(){
  const wrap = document.getElementById('workoutsContent');
  wrap.innerHTML = '';
  const m = getMultiplier();
  baseQuests.forEach(([name,val,type])=>{
    let displayVal = Math.round(val*m);
    const q = document.createElement('div');
    q.className = 'quest' + (completed.includes(name)?' done':'');
    q.dataset.name = name;
    q.innerHTML = `<div class="check ${completed.includes(name)?'checked':''}" onclick="toggleQuest(this)"></div><span>${name} – ${displayVal} ${type}</span>`;
    wrap.appendChild(q);
  });
}

window.toggleQuest = function(box){
  const quest = box.parentElement;
  const name = quest.dataset.name;
  if(completed.includes(name)) return;
  completed.push(name);
  str+=1; end+=1;
  exp+=10;
  if(exp>=expNeeded){ level+=1; exp=0; expNeeded=Math.floor(expNeeded*1.3); }
  saveData();
  buildQuests();
  updateUI();
  updateTimeline();
}

// --- UI UPDATE ---
function updateUI(){
  document.getElementById('level').textContent = level;
  document.getElementById('rank').textContent = getRank(level*10);
  document.getElementById('exp').textContent = `${exp} / ${expNeeded}`;
  document.getElementById('str').textContent = str;
  document.getElementById('end').textContent = end;
}

function updateTimeline(){
  document.getElementById('currentStreak').textContent = `Current Streak Days: ${streakDays}`;
  document.getElementById('missedStreak').textContent = `Missed Days: ${missedDays}`;
}

// --- TO DO ---
function addTodo(){
  const input = document.getElementById('newTask');
  const val = input.value.trim();
  if(!val) return;
  const todoList = document.getElementById('todoList');
  const div = document.createElement('div');
  div.className = 'quest';
  div.innerHTML = `<div class='check' onclick='this.classList.toggle("checked")'></div><span>${val}</span>`;
  todoList.appendChild(div);
  input.value='';
}

document.getElementById('addTaskBtn').addEventListener('click', addTodo);
document.getElementById('newTask').addEventListener('keydown', e=>{ if(e.key==='Enter') addTodo(); });

// --- INITIALIZE ---
loadData();
</script>
</body>
</html>
