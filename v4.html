<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Daily System</title>

<style>
:root {
  --bg:#070b12;
  --panel:#0e1624;
  --accent:#4fc3ff;
  --accent2:#7cff9a;
  --danger:#ff5f5f;
  --text:#e6f0ff;
  --muted:#9bb0cc;
}
* { box-sizing:border-box; margin:0; padding:0; }

html, body {
  width:100%;
  height:100%;
  font-family:'Times New Roman', Times, serif;
  font-style:italic;
  background:#070b12;
  color:var(--text);
}

.system-container {
  width:100%;
  height:100%;
  display:flex;
  justify-content:center;
  align-items:center;
  padding:20px 0;
}

.system {
  width:100%;
  max-width:1200px;
  height:95%;
  background:linear-gradient(180deg,#0e1624,#0a111d);
  border:1px solid #1c2a44;
  border-radius:16px;
  box-shadow:0 0 50px rgba(79,195,255,.3);
  padding:20px;
  display:flex;
  flex-direction:column;
  align-items:center;
  overflow:hidden;
}

h1 {
  font-size:2rem;
  color:var(--accent);
  text-align:center;
  margin-bottom:16px;
  animation:fadeInDown 1s ease;
}
@keyframes fadeInDown {
  from {opacity:0; transform:translateY(-30px);}
  to {opacity:1; transform:translateY(0);}
}

.status {
  display:grid;
  grid-template-columns: repeat(auto-fit, minmax(140px,1fr));
  gap:10px;
  margin-bottom:20px;
  width:100%;
}

.card {
  background:var(--panel);
  border:1px solid #1c2a44;
  border-radius:12px;
  padding:12px;
  text-align:center;
}
.card .label { font-size:.8rem; color:var(--muted); }
.card .value { font-size:1.3rem; margin-top:4px; }

.section {
  width:100%;
  margin-bottom:15px;
  border:1px solid #1c2a44;
  border-radius:12px;
  overflow:hidden;
  display:flex;
  flex-direction:column;
}
.section-header {
  background:var(--panel);
  padding:12px;
  cursor:pointer;
  display:flex;
  justify-content:space-between;
  align-items:center;
  user-select:none;
  font-weight:bold;
  font-size:1rem;
}
.section-content {
  max-height:0;
  overflow:hidden;
  transition:max-height 0.4s ease, padding 0.4s ease;
  display:flex;
  flex-direction:column;
  gap:6px;
  padding:0 12px;
}
.section-content.open {
  overflow-y:auto;
  padding:12px;
}

.quests {
  display:flex;
  flex-direction:column;
  gap:6px;
}

.quest {
  background:var(--panel);
  border:1px solid #1c2a44;
  border-radius:12px;
  padding:10px;
  display:flex;
  align-items:center;
  gap:12px;
  transition:all 0.3s ease;
  user-select:none;
}
.quest.done span { opacity:0.6; }
.quest.dragging { opacity:0.4; }

.drag-handle {
  cursor:grab;
  user-select:none;
  color:var(--muted);
  font-weight:bold;
}

.check {
  width:24px;
  height:24px;
  border-radius:6px;
  border:2px solid var(--accent);
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  transition:all 0.25s;
  flex-shrink:0;
}
.check.checked {
  background:var(--accent);
  box-shadow:0 0 14px rgba(79,195,255,.8);
}
.check.checked::after {
  content:'✓';
  color:#000;
  font-weight:700;
  animation:pop .25s ease-out;
}
@keyframes pop {
  from { transform:scale(.3); opacity:0; }
  to { transform:scale(1); opacity:1; }
}

.delete-btn {
  margin-left:auto;
  cursor:pointer;
  color:var(--danger);
  font-weight:bold;
}

/* ✅ GREEN NEON DRAG LINE */
.drag-line {
  height:2px;
  background:var(--accent2);
  box-shadow:0 0 12px rgba(124,255,154,.9);
  border-radius:2px;
  margin:4px 0;
  pointer-events:none;
}

.footer {
  margin-top:16px;
  text-align:center;
  font-size:.8rem;
  color:var(--muted);
  width:100%;
}
.timeline {
  margin-top:16px;
  font-size:0.9rem;
  color:var(--muted);
  text-align:center;
  width:100%;
  display:flex;
  justify-content:space-between;
}
.timeline div { flex:1; }

.todo-input {
  width:100%;
  display:flex;
  gap:8px;
  margin-bottom:10px;
}
.todo-input input {
  flex:1;
  padding:8px;
  border-radius:6px;
  border:1px solid #1c2a44;
  background:var(--panel);
  color:var(--text);
}
.todo-input button {
  padding:8px 14px;
  border-radius:6px;
  border:none;
  background:var(--accent);
  color:#000;
  cursor:pointer;
  font-weight:bold;
}

/* Password overlay */
#passwordOverlay {
  position:fixed;
  inset:0;
  background:black;
  display:flex;
  justify-content:center;
  align-items:center;
  z-index:1000;
  flex-direction:column;
}
#passwordOverlay input {
  padding:12px;
  font-size:1.2rem;
  border-radius:8px;
  border:none;
  background:#111;
  color:#fff;
  text-align:center;
  width:220px;
}
#passwordOverlay span {
  color:red;
  margin-top:12px;
  font-size:1rem;
  opacity:0;
  transition:opacity 0.3s;
}
</style>
</head>

<body>

<div id="passwordOverlay">
  <input type="password" id="passwordInput" placeholder="Enter Password" autofocus>
  <span id="pwError">Unauthorized Access</span>
</div>

<div class="system-container" style="display:none;">
  <div class="system">
    <h1>DAILY QUEST</h1>

    <div class="status">
      <div class="card"><div class="label">LEVEL</div><div id="level" class="value">1</div></div>
      <div class="card"><div class="label">RANK</div><div id="rank" class="value">E</div></div>
      <div class="card"><div class="label">EXP</div><div id="exp" class="value">0 / 100</div></div>
      <div class="card"><div class="label">STRENGTH</div><div id="str" class="value">0</div></div>
      <div class="card"><div class="label">ENDURANCE</div><div id="end" class="value">0</div></div>
    </div>

    <div class="section">
      <div class="section-header" onclick="toggleSection('workoutsContent')">
        Workout <span>&#9660;</span>
      </div>
      <div class="section-content" id="workoutsContent"></div>
    </div>

    <div class="section">
      <div class="section-header" onclick="toggleSection('todoContent')">
        To Do <span>&#9660;</span>
      </div>
      <div class="section-content" id="todoContent">
        <div class="todo-input">
          <input type="text" id="newTask" placeholder="Add new task and press Enter">
          <button id="addBtn">Add</button>
        </div>
        <div id="todoList" class="quests"></div>
      </div>
    </div>

    <div class="footer">Resets automatically at 00:00</div>
    <div class="timeline">
      <div id="currentStreak">Current Streak Days: 0</div>
      <div id="missedStreak">Missed Days: 0</div>
    </div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getDatabase, ref, get, set } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

const firebaseConfig = {
  projectId: "solo-leveling-36aca",
  databaseURL: "https://solo-leveling-36aca-default-rtdb.firebaseio.com"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const userId = 'defaultUser';

/* ---------- PASSWORD ---------- */
const overlay=document.getElementById('passwordOverlay');
const input=document.getElementById('passwordInput');
const errorMsg=document.getElementById('pwError');

input.addEventListener('keydown',e=>{
  if(e.key==='Enter'){
    if(input.value==='K@ilesh13'){
      overlay.style.display='none';
      document.querySelector('.system-container').style.display='flex';
      initSystem();
    }else errorMsg.style.opacity=1;
  }
});

function initSystem(){
let level=1, exp=0, expNeeded=100, str=0, end=0,
    completed=[], streakDays=0, missedDays=0, todoTasks=[];

const baseQuests=[
 ['Push-ups',25,'reps'], ['Sit-ups',100,'reps'], ['Squats',100,'reps'],
 ['Dips',100,'reps'], ['Inverted Rows',100,'reps'], ['Russian Twist',100,'reps'],
 ['Lunges',100,'reps'], ['Arm Presser (Each Side)',100,'reps'],
 ['Plank',3,'mins'], ['Left Side Plank',3,'mins'], ['Right Side Plank',3,'mins'],
 ['Swimming',60,'mins'], ['Cycling / Walking',10,'kms']
];

/* GREEN DRAG LINE */
const dragLine=document.createElement('div');
dragLine.className='drag-line';

/* ---------- FIREBASE ---------- */
async function loadData(){
  const snap=await get(ref(db,'users/'+userId));
  const d=snap.val();
  if(d){
    level=d.level||1; exp=d.exp||0; expNeeded=d.expNeeded||100;
    str=d.str||0; end=d.end||0; completed=d.completed||[];
    streakDays=d.streakDays||0; missedDays=d.missedDays||0;
    todoTasks=d.todoTasks||[];
  }
  buildQuests(); buildTodo(); updateUI(); updateTimeline();
}

function saveData(){
  set(ref(db,'users/'+userId),
    {level,exp,expNeeded,str,end,completed,streakDays,missedDays,todoTasks});
}

/* ---------- WORKOUT ---------- */
function getMultiplier(){ return 1+(level-1)*0.05; }

function buildQuests(){
  const wrap=document.getElementById('workoutsContent');
  wrap.innerHTML='';
  const m=getMultiplier();
  baseQuests.forEach(([name,val,type])=>{
    const display=name==='Swimming'?val:Math.round(val*m);
    const q=document.createElement('div');
    q.className='quest'+(completed.includes(name)?' done':'');
    q.dataset.name=name;
    q.innerHTML=
      `<div class="check ${completed.includes(name)?'checked':''}"
       onclick="toggleQuest(this)"></div>
       <span>${name} – ${display} ${type}</span>`;
    wrap.appendChild(q);
  });
}

window.toggleQuest=function(box){
  const quest=box.parentElement;
  const name=quest.dataset.name;
  if(completed.includes(name)) return;
  completed.push(name);
  if(name!=='Swimming'){ str++; end++; exp+=10; }
  if(exp>=expNeeded){ level++; exp=0; expNeeded=Math.floor(expNeeded*1.3); }
  saveData(); buildQuests(); updateUI(); updateTimeline();
};

/* ---------- UI ---------- */
window.toggleSection=function(id){
  const el=document.getElementById(id);
  if(el.classList.contains('open')){
    el.classList.remove('open'); el.style.maxHeight='0';
  }else{
    el.classList.add('open'); el.style.maxHeight=el.scrollHeight+'px';
  }
};

function updateUI(){
  level.textContent=level;
  rank.textContent='E';
  exp.textContent=`${exp} / ${expNeeded}`;
  str.textContent=str;
  end.textContent=end;
}
function updateTimeline(){
  currentStreak.textContent=`Current Streak Days: ${streakDays}`;
  missedStreak.textContent=`Missed Days: ${missedDays}`;
}

/* ---------- TODO (GREEN LINE DRAG) ---------- */
function buildTodo(){
  const list=document.getElementById('todoList');
  list.innerHTML='';
  todoTasks.forEach((task,index)=>{
    const div=document.createElement('div');
    div.className='quest';
    div.draggable=true;

    div.innerHTML=`
      <span class="drag-handle">::</span>
      <div class="check ${task.done?'checked':''}"></div>
      <span>${task.text}</span>
      <span class="delete-btn">✕</span>
    `;

    div.querySelector('.check').onclick=()=>{
      task.done=!task.done; saveData(); buildTodo();
    };
    div.querySelector('.delete-btn').onclick=()=>{
      todoTasks.splice(index,1); saveData(); buildTodo();
    };

    div.addEventListener('dragstart',e=>{
      e.dataTransfer.setData('text/plain',index);
      div.classList.add('dragging');
    });
    div.addEventListener('dragend',()=>{
      div.classList.remove('dragging');
      dragLine.remove();
    });
    div.addEventListener('dragover',e=>{
      e.preventDefault();
      const r=div.getBoundingClientRect();
      dragLine.remove();
      (e.clientY-r.top>r.height/2)
        ?div.after(dragLine)
        :div.before(dragLine);
    });
    div.addEventListener('drop',e=>{
      e.preventDefault();
      dragLine.remove();
      const from=parseInt(e.dataTransfer.getData('text/plain'));
      if(from===index) return;
      const moved=todoTasks.splice(from,1)[0];
      todoTasks.splice(index,0,moved);
      saveData(); buildTodo();
    });

    list.appendChild(div);
  });
}

addBtn.onclick=()=>{
  const v=newTask.value.trim();
  if(!v) return;
  todoTasks.push({text:v,done:false});
  newTask.value='';
  saveData(); buildTodo();
};

loadData();
}
</script>
</body>
</html>
